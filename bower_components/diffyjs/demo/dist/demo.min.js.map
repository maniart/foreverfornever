{"version":3,"sources":["webpack:///webpack/bootstrap bcaade2abaf6605fda74","webpack:///./demo/src/index.js","webpack:///./dist/diffy.min.js"],"names":["gridCanvas","document","querySelector","gridCtx","getContext","gridWidth","gridHeight","resolutionX","resolutionY","cellWidth","cellHeight","PI","Math","radius","drawGrid","matrix","forEach","row","rowIdx","column","colIdx","beginPath","fillStyle","arc","fill","closePath","diffy","resolution","x","y","sensitivity","threshold","debug","containerClassName","sourceDimensions","w","h","onFrame","window"],"mappings":"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","file":"demo.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bcaade2abaf6605fda74","/* eslint-disable no-console */\n\nimport { create } from '../../dist/diffy.min.js';\n\nconst gridCanvas = document.querySelector('#grid-canvas');\nconst gridCtx = gridCanvas.getContext('2d');\nconst gridWidth = 1040;\nconst gridHeight = 800;\nconst resolutionX = 20;\nconst resolutionY = 15;\nconst cellWidth = gridWidth / resolutionX;\nconst cellHeight = gridHeight / resolutionY;\nconst PI = Math.PI;\n\nlet radius = 0;\n\nfunction drawGrid(matrix) {\n  matrix.forEach((row, rowIdx) => {\n    row.forEach((column, colIdx) => {\n      radius = 10;\n      gridCtx.beginPath();\n      gridCtx.fillStyle = `rgb(${column}, ${column}, ${column})`;\n      gridCtx.arc(rowIdx * cellWidth, colIdx * cellHeight, radius, 0, (2 * PI), false);\n      gridCtx.fill();\n      gridCtx.closePath();\n    });\n  });\n}\n\nconst diffy = create({\n  resolution: { x: resolutionX, y: resolutionY },\n  sensitivity: 0.2,\n  threshold: 21,\n  debug: true,\n  containerClassName: 'diffy--demo-debugger',\n  sourceDimensions: { w: 130, h: 100},\n  onFrame: drawGrid\n});\n\nwindow.diffy = diffy;\n\n\n\n// WEBPACK FOOTER //\n// ./demo/src/index.js","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.Diffy=t():e.Diffy=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p=\"/\",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){\"use strict\";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.create=void 0;var r=i(2),a=n(r),o=i(3),s=n(o),d=i(4),l=n(d),u=i(5),h=n(u),c=i(7),f=!1;t.create=function(e){var t=e.resolution,i=e.sensitivity,n=e.threshold,r=e.debug,o=e.onFrame,d=e.sourceDimensions,u=e.containerClassName;if(!window)throw new Error(\"\\n      Diffy.js is meant to be used in the browser. :^)\\n      For more info, see: https://github.com/maniart/diffyjs/blob/master/README.md\\n    \");if(!(\"Worker\"in window))throw new Error(\"\\n      Diffy.js requires Web Workers.\\n      It looks like this environment does not support this feature. :(\\n      For more info, see: https://github.com/maniart/diffyjs/blob/master/README.md\\n    \");if(f)throw new Error(\"\\n      Yikes! It seems like a Diffy.js instance already exists on this page. :|\\n      For more info, see: https://github.com/maniart/diffyjs/blob/master/README.md\\n    \");var v=a.default.create({tickFn:s.default,captureFn:l.default,DiffWorker:h.default,roundFn:c.round,win:window,doc:document,resolution:t,sensitivity:i,threshold:n,debug:r,onFrame:o,sourceDimensions:d,containerClassName:u});return f=!0,v}},function(e,t){\"use strict\";function i(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){var n=t.tickFn,r=void 0===n?function(){}:n,a=t.captureFn,o=void 0===a?function(){}:a,s=t.DiffWorker,d=void 0===s?function(){}:s,l=t.roundFn,u=void 0===l?function(){}:l,h=t.win,c=void 0===h?{}:h,f=t.doc,v=void 0===f?{}:f,g=t.debug,m=void 0!==g&&g,p=t.sourceDimensions,w=void 0===p?{w:130,h:100}:p,b=t.onFrame,E=void 0===b?function(){}:b,y=t.sensitivity,C=void 0===y?.2:y,x=t.threshold,k=void 0===x?21:x,D=t.containerClassName,F=void 0===D?\"diffy--debug-view\":D,j=t.resolution,M=void 0===j?{x:10,y:5}:j;i(this,e);var I=c;this.doc=v;var W={audio:!1,video:{width:130,height:100}};this.captureConfig=Object.assign({},W,{video:{width:w.w,height:w.h}}),this.tickFn=r.bind(I),this.captureFn=o,this.roundFn=u,this.onFrame=E,this.currentImageData=null,this.previousImageData=null,this.resolutionX=M.x,this.resolutionY=M.y,this.sensitivity=C,this.threshold=k,this.debug=m,this.containerClassName=F,this.debugViewCollapsed=!1,this.sourceWidth=w.w,this.sourceHeight=w.h,this.worker=new d,this.initialized=!1,this.VERSION=\"1.2.2\",I.addEventListener(\"load\",this.init.bind(this))}return n(e,[{key:\"toVideo\",value:function(e,t){t.src=e}},{key:\"toCanvas\",value:function(e,t){t.getContext(\"2d\").drawImage(e,0,0,t.width,t.height)}},{key:\"mirror\",value:function(e){var t=e.getContext(\"2d\");return t.translate(e.width,0),t.scale(-1,1),e}},{key:\"compare\",value:function(e,t){var i=e.data,n=t.data,r=i.length,a=new ArrayBuffer(r);this.worker.postMessage({buffer:a,data1:i,data2:n,sensitivity:this.sensitivity,threshold:this.threshold,width:this.sourceWidth,height:this.sourceHeight})}},{key:\"drawBlendImageFromBuffer\",value:function(e){this.blendImageData.data.set(new Uint8ClampedArray(e)),this.blendCanvasCtx.putImageData(this.blendImageData,0,0),this.previousImageData=this.currentImageData}},{key:\"blend\",value:function(e){var t=e.getContext(\"2d\"),i=e.width,n=e.height;this.currentImageData=t.getImageData(0,0,i,n),this.previousImageData=this.previousImageData||t.getImageData(0,0,i,n),this.compare(this.currentImageData,this.previousImageData)}},{key:\"createMatrix\",value:function(){var e=void 0,t=void 0,i=0,n=[],r=this.sourceWidth,a=this.sourceHeight,o=this.sourceWidth/this.resolutionX,s=this.sourceHeight/this.resolutionY,d=null,l=void 0,u=void 0,h=0;for(e=0;e<r;e+=o){var c=[];for(t=0;t<a;t+=s){for(d=this.blendCanvasCtx.getImageData(e,t,o,s).data,l=d.length,u=l/4;i<u;)h+=(d[4*i]+d[4*i+1]+d[4*i+2])/3,++i;h=this.roundFn(h/u),c.push(h),h=0,i=0}n.push(c)}return n}},{key:\"loop\",value:function(){this.toCanvas(this.videoEl,this.rawCanvasEl),this.blend(this.rawCanvasEl),this.onFrame(this.createMatrix()),this.tickFn(this.loop.bind(this))}},{key:\"init\",value:function(){var e=this;this.worker.addEventListener(\"error\",function(e){throw e}),this.worker.addEventListener(\"message\",function(t){var i=t.data;e.drawBlendImageFromBuffer(i)}),this.initDom(this.containerClassName),this.blendCanvasCtx=this.blendCanvasEl.getContext(\"2d\"),this.blendImageData=this.blendCanvasCtx.getImageData(0,0,this.sourceWidth,this.sourceHeight),this.captureFn(this.captureConfig).then(function(t){[e.rawCanvasEl,e.blendCanvasEl].forEach(e.mirror),e.toVideo(t,e.videoEl),e.loop()}),this.initialized=!0}},{key:\"createElements\",value:function(e){var t=this;this.containerEl=this.doc.createElement(\"div\"),this.containerEl.className=e,this.videoEl=this.doc.createElement(\"video\"),this.videoEl.className=\"video view\",this.videoEl.setAttribute(\"autoplay\",\"\"),this.videoEl.width=this.sourceWidth,this.videoEl.height=this.sourceHeight,this.rawCanvasEl=this.doc.createElement(\"canvas\"),this.rawCanvasEl.className=\"canvas--raw view\",this.rawCanvasEl.width=this.sourceWidth,this.rawCanvasEl.height=this.sourceHeight,this.blendCanvasEl=this.doc.createElement(\"canvas\"),this.blendCanvasEl.className=\"canvas--blend view\",this.blendCanvasEl.width=this.sourceWidth,this.blendCanvasEl.height=this.sourceHeight,this.headerEl=this.doc.createElement(\"header\"),this.headerEl.className=\"header\",this.titleEl=this.doc.createElement(\"h1\"),this.titleEl.className=\"title\",this.titleEl.innerText=\"Diffy debug view\",this.toggleEl=this.doc.createElement(\"span\"),this.toggleEl.className=\"toggle\",this.toggleEl.innerText=\"-\",this.headerEl.addEventListener(\"click\",function(e){e.preventDefault(),[t.videoEl,t.rawCanvasEl,t.blendCanvasEl].forEach(function(e){t.debugViewCollapsed?(e.classList.remove(\"hidden\"),t.toggleEl.innerText=\"-\"):(e.classList.add(\"hidden\"),t.toggleEl.innerText=\"+\")}),t.debugViewCollapsed=!t.debugViewCollapsed}),this.headerEl.appendChild(this.toggleEl),this.headerEl.appendChild(this.titleEl),this.containerEl.appendChild(this.headerEl),this.containerEl.appendChild(this.videoEl),this.containerEl.appendChild(this.rawCanvasEl),this.containerEl.appendChild(this.blendCanvasEl),this.doc.body.appendChild(this.containerEl),this.debug||this.containerEl.classList.add(\"hidden\")}},{key:\"injectCssStyles\",value:function(){var e=this.doc.createElement(\"style\"),t=this.containerClassName,i=\"\\n      .\"+t+' {\\n        position: fixed;\\n        top: 0;\\n        left: 0;\\n        font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\\n        background-color: #000;\\n        border: 4px solid #000;\\n        color: #fff;\\n      }\\n      .'+t+\" .header {\\n        width: 100%;\\n        background-color: #000;\\n        font-size: 16px;\\n        cursor: pointer;\\n      }\\n      .\"+t+\" .title {\\n        display: inline;\\n        margin-left: 10px;\\n        font-weight: 300;\\n        letter-spacing: 2px;\\n        font-size: 16px;\\n      }\\n      .\"+t+\" .toggle { padding: 5px; }\\n      .\"+t+\" .view { padding: 5px; }\\n      .\"+t+\" .view.hidden, .\"+t+\".hidden { display: none; }\\n    \";e.innerHTML=i,this.doc.body.appendChild(e)}},{key:\"initDom\",value:function(e){this.createElements(e),this.injectCssStyles()}}],[{key:\"create\",value:function(e){return new this(e)}}]),e}();t.default=r},function(e,t){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.default=i},function(e,t){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function e(t,i,n){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return e?new Promise(function(i,n){e.call(navigator,t,i,n)}):Promise.reject(new Error(\"getUserMedia is not implemented in this browser\"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=i);var n=function(e){return navigator.mediaDevices.getUserMedia(e).then(function(e){return window.URL.createObjectURL(e)}).catch(function(e){var t=e.name,i=e.message;return console.error(t+\" : \"+i)})};t.default=n},function(e,t,i){e.exports=function(){return i(6)('!function(r){function e(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return r[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=r,e.c=t,e.p=\"/\",e(0)}([function(r,e,t){\"use strict\";var n=t(1),o=void 0,i=void 0,a=void 0,u=void 0,c=void 0,s=function(r){var e=r.data,t=e.buffer,s=e.data1,d=e.data2,f=e.width,v=e.height,l=e.sensitivity,p=e.threshold,g=0;c=1-l,o=new Uint32Array(t);for(var h=0;h<v;++h)for(var x=0;x<f;++x)g=h*f+x,i=(s[4*g]+s[4*g+1]+s[4*g+2])/3/c,a=(d[4*g]+d[4*g+1]+d[4*g+2])/3/c,u=(0,n.polarize)((0,n.abs)(i-a),p),o[g]=255<<24|u<<16|u<<8|u;postMessage(t)};onmessage=s},function(r,e){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.createOnceLog=function(){var r=0;return function(){if(r<1){var e;(e=console).log.apply(e,arguments)}r++}},e.$=function(r){return document.querySelector(r)},e.round=function(r){return r+.5>>0},e.abs=function(r){return(r^r>>31)-(r>>31)},e.polarize=function(r,e){return r>e?0:255}}]);\\n//# sourceMappingURL=4c4717f30fba17538544.worker.js.map',i.p+\"4c4717f30fba17538544.worker.js\")}},function(e,t){var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;n=new r,n.append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(i.createObjectURL(n))}catch(t){return new Worker(\"data:application/javascript,\"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}},function(e,t){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});t.createOnceLog=function(){var e=0;return function(){if(e<1){var t;(t=console).log.apply(t,arguments)}e++}},t.$=function(e){return document.querySelector(e)},t.round=function(e){return e+.5>>0},t.abs=function(e){return(e^e>>31)-(e>>31)},t.polarize=function(e,t){return e>t?0:255}}])});\n//# sourceMappingURL=diffy.min.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./dist/diffy.min.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}